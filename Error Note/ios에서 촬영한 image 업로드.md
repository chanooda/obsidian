### 환경
next.js 14.2.3
next.js 14.0.4

아이폰에서 찍은 사진을 업로드 할 때 사진의 방향이 제멋대로 바뀌어서 업로드되는 문제가 있었다. 그 오류를 해결하는 과정에서 흥미로운 점을 발견했다.

## 이미지를 관리하는 로직은 이러했다. 
1. 프론트에서 파일을 올리면 해당 파일의 원본은 서버에 저장된다.
2. 업로드된 이미지를 웹 사이트용 webp로 변환하여 생성
3. 특정 사용자에게 줄 크롭, 편집한 이미지 생성

## 이 이미지들을 활용하는 과정에서 문제가 발생했다. 
1. 2번 이미지는 웹사이트에서 사용자에게 보여주는 이미지였는데 특정 이미지가 시계 반대방향으로 90도 회전되어 보임
2. 2번 이미지가 서비스 개발 서버(production)에서는 정방향으로 잘 보이는데, 어드민 개발 서버(production)에서는 돌아가서 보임
3. 2번 이미지가 로컬 개발 모드, build 환경에서 모두 돌아가서 보임
4. 3번 이미지는 정상적인 방향으로 보임

## 원인 
복합적인 원인이 있었다. ios 환경에서 촬영된 이미지 중 특정 이미지가 회전되어서 업로드 되는 버그가 있었다. 해당 이미지가 업로드되면, 서버에는 메타데이터에 -90도로 회전되었다는 정보와 함께 저장된다. (원본 사진은 돌아감)

서비스 개발 서버에는 next.js에서 제공하는 Image 컴포넌트를 사용했기에, next.js에서 자체적으로 sharp를 이용해서 이미지를 정방향으로 돌려줘서, 원본은 회전 되었지만 next에서 변환된 이미지는 정방향으로 잘 보이게 된다.

어드민 개발 서버에서는 antd에서 제공하는 Image 컴포넌트를 사용하고 있었기에 서버에서 내려준 사진을 그대로 사용하면서 원래대로 방향아 돌아간 채 나온다.


